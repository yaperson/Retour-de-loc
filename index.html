<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="shortcut icon" href="./assets/icons/192.png" type="image/x-icon">
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json" />
    <title>ContrÃ´le MatÃ©riel MÃ©dical</title>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').then(registration => {
                console.log('Service Worker enregistrÃ©', registration);

                // ğŸ”„ Surveille les mises Ã  jour
                registration.addEventListener('updatefound', () => {
                    const newWorker = registration.installing;
                    if (!newWorker) return;

                    newWorker.addEventListener('statechange', () => {
                        if (newWorker.state === 'installed') {
                            if (navigator.serviceWorker.controller) {
                                // âœ… Nouvelle version prÃªte
                                showUpdateNotification();
                            }
                        }
                    });
                });
            }).catch(err => {
                console.error('Erreur lors de lâ€™enregistrement du Service Worker :', err);
            });
        }

    </script>
</head>

<body>

    <h1>ContrÃ´le MatÃ©riel MÃ©dical</h1>


    <button id="btnScan">ğŸ“· Scanner code-barres</button>
    <button id="endScan" title="Arreter le scan">âœ–ï¸</button>
    <div id="scanner"></div>

    <label for="serial_number">NumÃ©ro de sÃ©rie</label>
    <input type="text" id="serial_number">

    <label for="typeMateriel">Choisir le type de matÃ©riel :</label>
    <select id="typeMateriel" required>
        <option value="">-- SÃ©lectionner --</option>
        <option value="lit">Lit mÃ©dicalisÃ©</option>
        <option value="fauteuil_manuel">Fauteuil roulant manuel</option>
        <option value="fauteuil_electrique">Fauteuil roulant Ã©lectrique</option>
        <option value="leve_personne">LÃ¨ve-personne / verticalisateur</option>
        <option value="autre">Autre</option>
    </select>

    <div id="questionsContainer" class="questions"></div>

    <div class="notes_container" id="notes_container">
        <label for="notes">Notes :</label>
        <textarea name="notes" id="notes"></textarea>
    </div>

    <div id="photosContainer" style="margin-top:1.5rem; display:none;">
        <label>Photo de l'ensemble :</label>
        <input type="file" accept="image/*" capture="environment" id="photoEnsemble" />
        <img id="previewEnsemble" class="preview" alt="AperÃ§u photo ensemble" />

        <label>Photo de l'Ã©tiquette (nÂ° de sÃ©rie) :</label>
        <input type="file" accept="image/*" capture="environment" id="photoEtiquette" />
        <img id="previewEtiquette" class="preview" alt="AperÃ§u photo Ã©tiquette" />
    </div>

    <button id="btnSummary" disabled>Voir rÃ©sumÃ© & Partager</button>

    <!-- Modale rÃ©sumÃ© -->
    <div id="modal">
        <div>
            <button id="closeModal" title="Fermer la fenÃªtre">âœ–ï¸</button>
            <div id="modalContent"></div>
            <div style="text-align:center; margin-top:1.5rem;">
                <button id="btnModalPrint">ğŸ–¨ï¸ Imprimer</button>
                <button id="btnModalDownload">â¬‡ï¸ TÃ©lÃ©charger</button>
                <!-- <button id="btnModalMail">ğŸ“§ Envoyer par mail</button> -->
                <button id="btnModalShare">ğŸ“¤ Partager</button>
            </div>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
    <script src="app.js"></script>
</body>

</html>